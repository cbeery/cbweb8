<%# app/views/admin/books/show.html.erb %>
<% content_for :title, "#{@book.title} - Books" %>

<div class="min-h-screen bg-gray-50">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Back Navigation -->
    <div class="mb-6">
      <%= link_to admin_books_path, class: "inline-flex items-center text-indigo-600 hover:text-indigo-800" do %>
        <svg class="w-5 h-5 mr-1" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M7.707 14.707a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l2.293 2.293a1 1 0 010 1.414z" clip-rule="evenodd" />
        </svg>
        Back to Books
      <% end %>
    </div>
    
    <!-- Book Details Card -->
    <div class="bg-white rounded-lg shadow-lg overflow-hidden">
      <div class="lg:flex">
        <!-- Cover Section -->
        <div class="lg:w-1/3 xl:w-1/4 bg-gray-100">
          <div class="aspect-[2/3] relative p-8">
            <% if @book.cover_image.attached? %>
              <%= image_tag @book.cover_image,
                  alt: @book.title,
                  class: "w-full h-full object-contain" %>
            <% else %>
              <div class="w-full h-full flex items-center justify-center bg-gray-200">
                <span class="text-gray-400">No Cover</span>
              </div>
            <% end %>
          </div>
        </div>
        
        <!-- Details Section -->
        <div class="lg:w-2/3 xl:w-3/4 p-8">
          <div class="mb-4">
            <h1 class="text-3xl font-bold text-gray-900"><%= @book.title %></h1>
            <p class="text-xl text-gray-600 mt-2">by <%= @book.author %></p>
            
            <% if @book.full_series_name %>
              <p class="text-sm text-gray-500 mt-1"><%= @book.full_series_name %></p>
            <% end %>
          </div>
          
          <!-- Status and Rating -->
          <div class="flex items-center gap-4 mb-6">
            <span class="px-3 py-1 text-sm rounded-full
              <%= @book.read? ? 'bg-green-100 text-green-800' : '' %>
              <%= @book.currently_reading? ? 'bg-blue-100 text-blue-800' : '' %>
              <%= @book.want_to_read? ? 'bg-gray-100 text-gray-800' : '' %>">
              <%= @book.display_status %>
            </span>
            
            <% if @book.rating %>
              <div class="flex items-center">
                <% (1..5).each do |i| %>
                  <% if i <= @book.rating %>
                    <span class="text-yellow-500">★</span>
                  <% elsif i - 0.5 <= @book.rating %>
                    <span class="text-yellow-500">⯨</span>
                  <% else %>
                    <span class="text-gray-300">★</span>
                  <% end %>
                <% end %>
                <span class="ml-2 text-gray-600"><%= @book.rating %></span>
              </div>
            <% end %>
          </div>
          
          <!-- Book Info Grid -->
          <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-6">
            <% if @book.started_on %>
              <div>
                <dt class="text-sm font-medium text-gray-500">Started</dt>
                <dd class="mt-1 text-sm text-gray-900"><%= @book.started_on.strftime("%B %d, %Y") %></dd>
              </div>
            <% end %>
            
            <% if @book.finished_on %>
              <div>
                <dt class="text-sm font-medium text-gray-500">Finished</dt>
                <dd class="mt-1 text-sm text-gray-900"><%= @book.finished_on.strftime("%B %d, %Y") %></dd>
              </div>
            <% end %>
            
            <% if @book.page_count %>
              <div>
                <dt class="text-sm font-medium text-gray-500">Pages</dt>
                <dd class="mt-1 text-sm text-gray-900"><%= @book.page_count %></dd>
              </div>
            <% end %>
            
            <% if @book.published_year %>
              <div>
                <dt class="text-sm font-medium text-gray-500">Published</dt>
                <dd class="mt-1 text-sm text-gray-900"><%= @book.published_year %></dd>
              </div>
            <% end %>
            
            <% if @book.publisher %>
              <div>
                <dt class="text-sm font-medium text-gray-500">Publisher</dt>
                <dd class="mt-1 text-sm text-gray-900"><%= @book.publisher %></dd>
              </div>
            <% end %>
            
            <% if @book.times_read > 0 %>
              <div>
                <dt class="text-sm font-medium text-gray-500">Times Read</dt>
                <dd class="mt-1 text-sm text-gray-900"><%= @book.times_read %></dd>
              </div>
            <% end %>
            
            <% if @book.currently_reading? && @book.progress %>
              <div>
                <dt class="text-sm font-medium text-gray-500">Progress</dt>
                <dd class="mt-1">
                  <div class="flex items-center">
                    <div class="flex-1 bg-gray-200 rounded-full h-2">
                      <div class="bg-blue-600 h-2 rounded-full" style="width: <%= @book.progress %>%"></div>
                    </div>
                    <span class="ml-2 text-sm text-gray-900"><%= @book.progress %>%</span>
                  </div>
                </dd>
              </div>
            <% end %>
          </div>
          
          <!-- Description -->
          <% if @book.description.present? %>
            <div class="mb-6">
              <h3 class="text-sm font-medium text-gray-500 mb-2">Description</h3>
              <p class="text-gray-700 whitespace-pre-wrap"><%= @book.description %></p>
            </div>
          <% end %>
          
          <!-- Actions -->
          <div class="flex gap-2">
            <%= link_to "Edit", edit_admin_book_path(@book),
                class: "px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700" %>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Metadata (if needed for debugging) -->
    <% if @metadata.present? && Rails.env.development? %>
      <div class="mt-6 bg-white rounded-lg shadow p-6">
        <h3 class="text-lg font-semibold mb-4">API Metadata</h3>
        <pre class="text-xs bg-gray-100 p-4 rounded overflow-x-auto"><%= JSON.pretty_generate(@metadata) %></pre>
      </div>
    <% end %>
  </div>
</div>