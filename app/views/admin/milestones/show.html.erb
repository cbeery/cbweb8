<!-- app/views/admin/milestones/show.html.erb -->
<div class="container mx-auto px-4 py-8">
  <!-- Header -->
  <div class="flex justify-between items-center mb-8">
    <div>
      <h1 class="text-3xl font-bold text-gray-800"><%= @milestone.title %></h1>
      <p class="text-gray-600 mt-2">
        <%= link_to @milestone.bicycle.name, admin_bicycle_path(@milestone.bicycle), 
            class: "text-blue-600 hover:text-blue-900" %> • 
        <%= @milestone.occurred_on.strftime("%B %d, %Y") %>
      </p>
    </div>
    <div class="flex gap-2">
      <%= link_to "Edit", edit_admin_milestone_path(@milestone), 
                  class: "bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition" %>
      <%= link_to "Delete", admin_milestone_path(@milestone), 
                  method: :delete,
                  data: { confirm: "Are you sure?" },
                  class: "bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 transition" %>
    </div>
  </div>

  <% if @milestone.description.present? %>
    <div class="bg-gray-50 rounded p-4 mb-6">
      <p class="text-gray-700"><%= @milestone.description %></p>
    </div>
  <% end %>

  <!-- Activity Summary -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
    <div class="bg-white rounded-lg shadow p-6">
      <p class="text-sm text-gray-600 mb-1">Miles Since</p>
      <p class="text-3xl font-bold text-gray-900">
        <%= number_with_delimiter(@activity_summary[:miles].round) %>
      </p>
      <p class="text-sm text-gray-500 mt-1">
        <%= @activity_summary[:average_miles_per_week].round(1) %> miles/week
      </p>
    </div>
    
    <div class="bg-white rounded-lg shadow p-6">
      <p class="text-sm text-gray-600 mb-1">Rides Since</p>
      <p class="text-3xl font-bold text-gray-900">
        <%= @activity_summary[:rides] %>
      </p>
      <p class="text-sm text-gray-500 mt-1">
        <%= @activity_summary[:average_miles_per_ride].round(1) %> miles/ride
      </p>
    </div>
    
    <div class="bg-white rounded-lg shadow p-6">
      <p class="text-sm text-gray-600 mb-1">Days Elapsed</p>
      <p class="text-3xl font-bold text-gray-900">
        <%= @activity_summary[:days_elapsed] %>
      </p>
      <p class="text-sm text-gray-500 mt-1">
        <%= (@activity_summary[:days_elapsed] / 7.0).round(1) %> weeks
      </p>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
    <!-- Adjacent Milestones -->
    <div class="bg-white rounded-lg shadow">
      <div class="px-6 py-4 border-b border-gray-200">
        <h2 class="text-lg font-semibold text-gray-900">Adjacent Milestones</h2>
      </div>
      <div class="p-6 space-y-4">
        <% if @previous_milestone %>
          <div class="border-l-4 border-gray-300 pl-4">
            <p class="text-sm text-gray-500">Previous</p>
            <%= link_to @previous_milestone.title, admin_milestone_path(@previous_milestone),
                class: "font-medium text-gray-900 hover:text-blue-600" %>
            <p class="text-sm text-gray-600">
              <%= @previous_milestone.occurred_on.strftime("%B %d, %Y") %> • 
              <%= @milestone.occurred_on - @previous_milestone.occurred_on %> days before this
            </p>
          </div>
        <% end %>
        
        <div class="border-l-4 border-blue-500 pl-4">
          <p class="text-sm text-gray-500">Current</p>
          <p class="font-medium text-gray-900"><%= @milestone.title %></p>
          <p class="text-sm text-gray-600"><%= @milestone.occurred_on.strftime("%B %d, %Y") %></p>
        </div>
        
        <% if @next_milestone %>
          <div class="border-l-4 border-gray-300 pl-4">
            <p class="text-sm text-gray-500">Next</p>
            <%= link_to @next_milestone.title, admin_milestone_path(@next_milestone),
                class: "font-medium text-gray-900 hover:text-blue-600" %>
            <p class="text-sm text-gray-600">
              <%= @next_milestone.occurred_on.strftime("%B %d, %Y") %> • 
              <%= @next_milestone.occurred_on - @milestone.occurred_on %> days after this
            </p>
          </div>
        <% end %>
      </div>
    </div>

    <!-- Recent Rides Since This Milestone -->
    <div class="bg-white rounded-lg shadow">
      <div class="px-6 py-4 border-b border-gray-200">
        <div class="flex justify-between items-center">
          <h2 class="text-lg font-semibold text-gray-900">Rides Since</h2>
          <%= link_to "View All", admin_rides_path(bicycle_id: @milestone.bicycle_id, start_date: @milestone.occurred_on), 
                      class: "text-sm text-blue-600 hover:text-blue-900" %>
        </div>
      </div>
      <div class="divide-y divide-gray-200">
        <% @rides_since.each do |ride| %>
          <div class="px-6 py-4">
            <div class="flex justify-between items-start">
              <div>
                <p class="font-medium text-gray-900">
                  <%= link_to ride.rode_on.strftime("%B %d, %Y"), admin_ride_path(ride),
                      class: "hover:text-blue-600" %>
                </p>
                <p class="text-sm text-gray-600">
                  <%= ride.miles %> miles
                  <% if ride.duration.present? && ride.duration > 0 %>
                    • <%= ride.duration_formatted %>
                  <% end %>
                </p>
                <% if ride.notes.present? %>
                  <p class="text-sm text-gray-500 mt-1"><%= truncate(ride.notes, length: 100) %></p>
                <% end %>
              </div>
            </div>
          </div>
        <% end %>
        
        <% if @rides_since.empty? %>
          <div class="px-6 py-4">
            <p class="text-gray-500">No rides since this milestone yet.</p>
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <!-- Maintenance Specific Info -->
  <% if @milestone.maintenance? %>
    <div class="mt-8 bg-amber-50 border border-amber-200 rounded-lg p-6">
      <h3 class="text-lg font-semibold text-amber-900 mb-2">
        Maintenance Tracking
      </h3>
      <p class="text-amber-800">
        This is a maintenance milestone. You've put 
        <strong><%= number_with_delimiter(@activity_summary[:miles].round) %> miles</strong> 
        on your <%= @milestone.bicycle.name %> since this maintenance.
      </p>
      <% if @activity_summary[:miles] > 1000 %>
        <p class="text-amber-700 mt-2">
          Consider checking if any maintenance is needed - you've exceeded 1,000 miles.
        </p>
      <% end %>
    </div>
  <% end %>

  <!-- Navigation -->
  <div class="mt-8 flex justify-between">
    <%= link_to "← Back to Milestones", admin_milestones_path, 
                class: "text-gray-600 hover:text-gray-900" %>
    <%= link_to "View Bicycle →", admin_bicycle_path(@milestone.bicycle), 
                class: "text-gray-600 hover:text-gray-900" %>
  </div>
</div>
