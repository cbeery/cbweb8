<%# app/views/home/_hoops_card.html.erb %>
<%# NBA Games Watched Card with Chartkick stacked bar chart %>
<%# Expects: @current_nba_season, @nba_chart_data, @nba_team_colors, @nba_games_watched, @nba_top_teams %>

<div class="bg-white rounded-lg shadow-lg">
  <!-- Card Header -->
  <div class="p-4 border-b">
    <h2 class="text-xl font-bold">
      Hoops
      <span class="font-thin text-gray-400">(<%= @current_nba_season %>)</span>
    </h2>
    <%# Subheading - commented out for potential future use on other cards %>
    <%# <p class="text-sm text-gray-500 mt-0.5">NBA games watched, by team (so total is doubled), current season.</p> %>
  </div>
  
  <!-- Chart Area -->
  <div class="p-4">
    <% if @nba_chart_data.present? && @nba_chart_data.any? %>
      <%= bar_chart @nba_chart_data, 
                    stacked: true, 
                    colors: @nba_team_colors,
                    height: "60px",
                    dataset: {
                      borderWidth: 0
                    },
                    library: {
                      indexAxis: 'y',
                      plugins: {
                        legend: { display: false },
                        tooltip: {
                          mode: 'point',
                          intersect: true,
                          position: 'nearest'
                        }
                      },
                      scales: {
                        x: { 
                          stacked: true,
                          display: false,
                          grace: 0,
                          max: @nba_chart_max
                        },
                        y: { 
                          stacked: true,
                          display: false
                        }
                      }
                    } %>
    <% else %>
      <div class="py-8 text-center">
        <div class="text-4xl mb-2">üèÄ</div>
        <p class="text-gray-500 text-sm">No games watched yet this season.</p>
        <p class="text-gray-400 text-xs mt-1"><%= @current_nba_season %></p>
      </div>
    <% end %>
  </div>
  
  <!-- Card Footer -->
  <div class="px-4 py-3 bg-gray-50 border-t rounded-b-lg">
    <div class="flex justify-between items-center text-sm text-gray-600">
      <span class="flex items-center gap-1">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
          <path stroke-linecap="round" stroke-linejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
        </svg>
        <span class="hidden sm:inline">Watched:</span>
        <span class="font-medium"><%= @nba_games_watched %></span>
      </span>
      <span class="flex items-center gap-3">
        <%# Show 3 teams on sm-, 5 on md/lg, 8 on xl+ %>
        <% @nba_top_teams.first(8).each_with_index do |team_data, index| %>
          <%
            visibility = if index < 3
              'flex'           # Always visible (sm and smaller)
            elsif index < 5
              'hidden md:flex' # Visible on md+ (md and lg add 4th & 5th)
            else
              'hidden xl:flex' # Visible on xl+ (xl adds 6th, 7th, 8th)
            end
          %>
          <span class="<%= visibility %> items-center gap-1">
            <% if team_data[:team]&.logo&.attached? %>
              <%= image_tag team_data[:team].logo, class: "w-5 h-5 object-contain", alt: team_data[:team].abbreviation %>
            <% else %>
              <span class="inline-block w-4 h-4 rounded-full" style="background-color: <%= team_data[:team]&.color || '#6B7280' %>;"></span>
            <% end %>
            <span class="font-medium"><%= team_data[:count] %></span>
          </span>
        <% end %>
      </span>
    </div>
  </div>
</div>
