<%#
  Public Page Layout Partial

  A reusable layout pattern for public-facing index pages with:
  - Header section (heading, subheading, intro text)
  - Main content area (9-10 cols on lg+)
  - Sidebar with three subsections

  Usage with content_for blocks:
    content_for :public_page_header - heading area
    content_for :sidebar_intro - context above main on mobile
    content_for :sidebar_nav - navigation links
    content_for :sidebar_details - extras below main on mobile

  Locals:
    heading, subheading, intro_text - alternative to content_for header
    sidebar_nav_title - title for nav section (default: "Sections")
    sidebar_nav_links - array of {label:, path:, active:} hashes
    show_sidebar - boolean (default: true)
%>

<%
  heading = local_assigns[:heading]
  subheading = local_assigns[:subheading]
  intro_text = local_assigns[:intro_text]
  sidebar_nav_title = local_assigns[:sidebar_nav_title] || "Sections"
  sidebar_nav_links = local_assigns[:sidebar_nav_links] || []
  show_sidebar = local_assigns.fetch(:show_sidebar, true)
%>

<div class="public-page px-4 sm:px-6 lg:px-8 py-6">
  <%# Header Section %>
  <% if heading.present? || content_for?(:public_page_header) %>
    <header class="mb-6">
      <% if content_for?(:public_page_header) %>
        <%= yield :public_page_header %>
      <% else %>
        <h1 class="text-3xl font-bold text-gray-900"><%= heading %></h1>
        <% if subheading.present? %>
          <p class="mt-1 text-lg text-gray-600"><%= subheading %></p>
        <% end %>
        <% if intro_text.present? %>
          <p class="mt-3 text-gray-700"><%= intro_text %></p>
        <% end %>
      <% end %>
    </header>
  <% end %>

  <%# Main Layout Container - flex on mobile for ordering, grid on lg+ %>
  <div class="flex flex-col <%= show_sidebar ? 'lg:grid lg:grid-cols-12 lg:gap-8' : '' %>">

    <%# Main Content Area - comes first in DOM but ordered 3rd on mobile %>
    <main class="order-3 lg:order-none <%= show_sidebar ? 'lg:col-span-9 lg:col-start-1 lg:row-start-1' : '' %>">
      <% if content_for?(:public_page_main) %>
        <%= yield :public_page_main %>
      <% else %>
        <%= yield %>
      <% end %>
    </main>

    <%# Sidebar - in right column on desktop, reordered on mobile %>
    <% if show_sidebar %>
      <aside class="contents lg:block lg:col-span-3 lg:col-start-10 lg:row-start-1">
        <%# Subsection 1: Intro/Context (above main on mobile) %>
        <% if content_for?(:sidebar_intro) %>
          <div class="order-1 lg:order-none mb-6 lg:mb-4">
            <%= yield :sidebar_intro %>
          </div>
        <% end %>

        <%# Subsection 2: Navigation (above main on mobile, collapsible) %>
        <% if sidebar_nav_links.any? || content_for?(:sidebar_nav) %>
          <nav class="order-2 lg:order-none mb-6 lg:mb-4" data-controller="collapsible" data-collapsible-open-value="false">
            <%# Mobile: collapsible header %>
            <button type="button"
                    class="lg:hidden flex items-center justify-between w-full py-2 px-3 bg-gray-100 rounded-lg text-left"
                    data-action="click->collapsible#toggle">
              <span class="font-medium text-gray-700"><%= sidebar_nav_title %></span>
              <svg class="w-5 h-5 text-gray-500 transition-transform"
                   data-collapsible-target="icon"
                   fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
              </svg>
            </button>

            <%# Desktop: always visible title %>
            <h3 class="hidden lg:block text-sm font-semibold text-gray-500 uppercase tracking-wider mb-2">
              <%= sidebar_nav_title %>
            </h3>

            <%# Navigation links %>
            <div class="hidden lg:block" data-collapsible-target="content">
              <% if content_for?(:sidebar_nav) %>
                <%= yield :sidebar_nav %>
              <% else %>
                <ul class="mt-2 lg:mt-0 space-y-1">
                  <% sidebar_nav_links.each do |link| %>
                    <li>
                      <%= link_to link[:label], link[:path],
                          class: "block py-2 px-3 lg:px-2 text-gray-700 hover:bg-gray-50 hover:text-indigo-600 rounded-md transition-colors #{link[:active] ? 'bg-indigo-50 text-indigo-700 font-medium' : ''}" %>
                    </li>
                  <% end %>
                </ul>
              <% end %>
            </div>
          </nav>
        <% end %>

        <%# Subsection 3: Details/Extras (below main on mobile) %>
        <% if content_for?(:sidebar_details) %>
          <div class="order-4 lg:order-none mt-8 lg:mt-4">
            <%= yield :sidebar_details %>
          </div>
        <% end %>
      </aside>
    <% end %>

  </div>
</div>
